<!-- CLEAN & FIXED VERSION (ì¤‘ë³µ/ì˜¤íƒ€ ì™„ì „ ì œê±°) -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DAISM </title>
  <style>
    :root{--bg:#0b0f1a;--panel:#0f1724;--accent:#7c3aed;--muted:#9fb0ff}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, Arial, sans-serif;background:linear-gradient(180deg,var(--bg),#061018);color:#ecf2ff}
    .page{display:none;min-height:100vh;align-items:center;justify-content:center;padding:28px}
    .active{display:flex}
    .card{background:rgba(255,255,255,0.03);padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.6);max-width:980px;width:100%}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    button{background:var(--accent);border:none;padding:10px 14px;color:white;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    input{padding:10px;border:none;border-radius:8px;width:100%;margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}
    .bgm-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:16px}
    .bgm-item{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:8px}
  </style>
</head>
<body>

  <!-- MAIN -->
  <section id="main" class="page active">
    <div class="card">
      <h1>ğŸµ DAISM</h1>
      <p class="muted">ë¡œê·¸ì¸ í›„ ìŒì•… ì œì‘ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
      <div class="row">
        <button onclick="goTo('login')">ìŒì•… ë§Œë“¤ê¸°</button>
        <button class="ghost" onclick="goTo('login')">ë¡œê·¸ì¸</button>
        <button class="ghost" onclick="goTo('signup')">íšŒì›ê°€ì…</button>
      </div>
    </div>
  </section>

  <!-- LOGIN -->
  <section id="login" class="page">
    <div class="card" style="max-width:420px">
      <h2>ë¡œê·¸ì¸</h2>
      <input id="loginEmail" placeholder="ì´ë©”ì¼" />
      <input id="loginPass" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
      <div class="row">
        <button onclick="doLogin()">ë¡œê·¸ì¸</button>
        <button class="ghost" onclick="goTo('main')">ë©”ì¸ìœ¼ë¡œ</button>
      </div>
      <div style="text-align:right"><a onclick="goTo('signup')" style="cursor:pointer;color:var(--muted)">íšŒì›ê°€ì… â†’</a></div>
    </div>
  </section>

  <!-- SIGNUP -->
  <section id="signup" class="page">
    <div class="card" style="max-width:420px">
      <h2>íšŒì›ê°€ì…</h2>
      <input id="signEmail" placeholder="ì´ë©”ì¼" />
      <input id="signPass" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
      <input id="signPass2" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" />
      <div class="row">
        <button onclick="doSignup()">ê°€ì…í•˜ê¸°</button>
        <button class="ghost" onclick="goTo('main')">ë©”ì¸ìœ¼ë¡œ</button>
      </div>
      <div style="text-align:right"><a onclick="goTo('login')" style="cursor:pointer;color:var(--muted)">ë¡œê·¸ì¸ â†’</a></div>
    </div>
  </section>

  <!-- MUSIC STUDIO -->
  <section id="music" class="page">
    <div class="card">
      <h2>ğŸš DAISM</h2>
      <p class="muted">18 BGM + ì—…ë¡œë“œ ê¸°ëŠ¥ ì§€ì›</p>
      <input id="fileInput" type="file" accept="audio/*" />
      <button class="ghost" onclick="stopAll()">ëª¨ë‘ ì •ì§€</button>
      <button class="ghost" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      <h3>ì¥ë¥´ ì„ íƒ</h3>
<div id="genreCards" class="bgm-grid"></div>
<h3>ë¶„ìœ„ê¸° ì„ íƒ</h3>
<div id="moodCards" class="bgm-grid"></div>
<button id="applySelection" class="ghost">ìƒì„±í•˜ê¸°<\/button>
<button id="deleteSelected" class="ghost" style="margin-left:8px;">ì„ íƒ ì‚­ì œ<\/button>
<div id="bgmGrid" class="bgm-grid"></div>
    </div>
  </section>

<script>
// í˜ì´ì§€ ì´ë™
function goTo(id){
  if(id==='music' && localStorage.getItem('loggedIn')!=='true'){
    alert('ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    id='login';
  }
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ìƒˆë¡œê³ ì¹¨ ì‹œ ë¡œê·¸ì¸ ìœ ì§€
window.onload = () => {
  if(localStorage.getItem('loggedIn') === 'true'){
    goTo('music');
  }
};

// íšŒì›ê°€ì…
function doSignup(){
  const email=document.getElementById('signEmail').value.trim();
  const p1=document.getElementById('signPass').value;
  const p2=document.getElementById('signPass2').value;
  if(!email||!p1) return alert('ì…ë ¥ ë¶€ì¡±');
  if(p1!==p2) return alert('ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜');
  const users=JSON.parse(localStorage.getItem('users')||'{}');
  if(users[email]) return alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼');
  users[email]={pass:p1};
  localStorage.setItem('users',JSON.stringify(users));
  alert('ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸í•˜ì„¸ìš”.');
  goTo('login');
  document.getElementById('loginEmail').value=email;
}

// ë¡œê·¸ì¸
function doLogin(){
  const email=document.getElementById('loginEmail').value.trim();
  const pass=document.getElementById('loginPass').value;
  const users=JSON.parse(localStorage.getItem('users')||'{}');
  if(users[email] && users[email].pass===pass){
    localStorage.setItem('loggedIn','true');
    alert('ë¡œê·¸ì¸ ì„±ê³µ');
    goTo('music');
  } else alert('ë¡œê·¸ì¸ ì‹¤íŒ¨');
}

function logout(){ localStorage.removeItem('loggedIn'); goTo('main'); }

// WebAudio ì—”ì§„
const AudioCtx=window.AudioContext||window.webkitAudioContext;
const ctx=new AudioCtx();
const master=ctx.createGain(); master.connect(ctx.destination);
const bgms=[];

// ì¹´ë“œ ì„ íƒ
const genres=['ë¡œíŒŒì´','ê²Œì„','í™í•©','EDM','í˜¸ëŸ¬','ííŠ¸','ì¬ì¦ˆ','ë¡','íŒíƒ€ì§€','ì•°ë¹„ì–¸íŠ¸'];
const moods=['ì°¨ë¶„í•œ','ì—ë„ˆì§€ìˆëŠ”','ëª½í™˜ì ì¸','ì–´ë‘ìš´','ë°ì€','ìŠ¬í”ˆ','ì¥ì—„í•œ','í¸ì•ˆí•œ','ê¸´ì¥ê°ìˆëŠ”','ë¯¸ë‹ˆë©€í•œ'];

const genreWrap=document.getElementById('genreCards');
const moodWrap=document.getElementById('moodCards');
let selectedGenres=[], selectedMoods=[];

function createCard(name, type){
  const card = document.createElement('div');
  card.className = 'bgm-item';
  card.style.cursor = 'pointer';

  const title = document.createElement('div');
  title.textContent = name;

  const del = document.createElement('button');
  del.textContent = 'ì‚­ì œ';
  del.style.marginTop = '6px';
  del.style.background = 'transparent';
  del.style.border = '1px solid rgba(255,255,255,0.2)';
  del.style.cursor = 'pointer';

  function toggleSelect(){
    if(type === 'genre'){
      if(selectedGenres.includes(name)){
        selectedGenres = selectedGenres.filter(v => v !== name);
        card.style.border = 'none';
      } else {
        selectedGenres.push(name);
        card.style.border = '1px solid var(--accent)';
      }
    } else {
      if(selectedMoods.includes(name)){
        selectedMoods = selectedMoods.filter(v => v !== name);
        card.style.border = 'none';
      } else {
        selectedMoods.push(name);
        card.style.border = '1px solid var(--accent)';
      }
    }
  }

  card.addEventListener('click', toggleSelect);

  del.addEventListener('click', (e) => {
    e.stopPropagation();

    if(type === 'genre'){
      selectedGenres = selectedGenres.filter(v => v !== name);
    } else {
      selectedMoods = selectedMoods.filter(v => v !== name);
    }

    card.remove();
  });

  card.append(title, del);
  return card;
}

genres.forEach(g=>genreWrap.appendChild(createCard(g,'genre')));
moods.forEach(m=>moodWrap.appendChild(createCard(m,'mood')));

// ì§ì ‘ ì…ë ¥ ì¹´ë“œ
function createInputCard(type){
  const card=document.createElement('div'); card.className='bgm-item';
  const label=document.createElement('div'); label.textContent='ì§ì ‘ ì…ë ¥';
  const input=document.createElement('input'); input.placeholder='ì…ë ¥...';
  const btn=document.createElement('button'); btn.textContent='ì¶”ê°€';

  btn.onclick=()=>{
    const val=input.value.trim(); if(!val) return alert('ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.');
    const newCard=createCard(val,type);
    if(type==='genre'){
      selectedGenres.push(val); genreWrap.insertBefore(newCard,card);
    } else {
      selectedMoods.push(val); moodWrap.insertBefore(newCard,card);
    }
    input.value='';
  };

  card.style.height = '120px';
  input.style.width = '100%';
  btn.style.width = '100%';

  card.append(label,input,btn);
  return card;
}

genreWrap.appendChild(createInputCard('genre'));
moodWrap.appendChild(createInputCard('mood'));

// ì ìš© ë²„íŠ¼ ë° ì„ íƒ ì‚­ì œ ê¸°ëŠ¥

document.getElementById('applySelection').onclick = () => {
  if(selectedGenres.length===0 || selectedMoods.length===0)
    return alert('ì¥ë¥´ì™€ ë¶„ìœ„ê¸°ë¥¼ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.');

  alert(
    'ì„ íƒëœ ì¥ë¥´: ' + selectedGenres.join(', ') +
    ' / ë¶„ìœ„ê¸°: ' + selectedMoods.join(', ') + '\ní•´ë‹¹ ì¡°ê±´ìœ¼ë¡œ BGM ìƒì„± ì¤€ë¹„ë¨!'
  );
};

// ì„ íƒ ì‚­ì œ ê¸°ëŠ¥
document.getElementById('deleteSelected').onclick = () => {
  if(selectedGenres.length===0 && selectedMoods.length===0)
    return alert('ì‚­ì œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');

  // ì¥ë¥´ ì¹´ë“œ ì‚­ì œ
  document.querySelectorAll('#genreCards .bgm-item').forEach(card => {
    const name = card.firstChild.textContent;
    if(selectedGenres.includes(name)) card.remove();
  });

  // ë¶„ìœ„ê¸° ì¹´ë“œ ì‚­ì œ
  document.querySelectorAll('#moodCards .bgm-item').forEach(card => {
    const name = card.firstChild.textContent;
    if(selectedMoods.includes(name)) card.remove();
  });

  selectedGenres = [];
  selectedMoods = [];

  alert('ì„ íƒëœ ì¹´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
};

// ì „ì²´ ì •ì§€
function stopAll(){
  bgms.forEach(t=>t.stop());
  document.querySelectorAll('.bgm-item button').forEach(b=>b.textContent='Play');
}
</script>
</body>
</html>
